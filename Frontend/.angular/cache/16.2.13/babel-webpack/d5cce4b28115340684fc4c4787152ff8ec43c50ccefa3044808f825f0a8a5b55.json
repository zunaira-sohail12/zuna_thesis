{"ast":null,"code":"import * as i0 from '@angular/core';\nimport { Injectable, EventEmitter, Directive, Input, Output, NgModule } from '@angular/core';\nimport { saveAs } from 'file-saver';\nimport * as i2 from '@angular/common/http';\nimport { HttpParams } from '@angular/common/http';\nimport { Subject, fromEvent, filter, takeUntil } from 'rxjs';\n\n/** Check the `Blob` existance only once. */\nlet isFileSaverSupported;\ntry {\n  isFileSaverSupported = !!new Blob();\n} catch {\n  isFileSaverSupported = false;\n}\nlet FileSaverService = /*#__PURE__*/(() => {\n  class FileSaverService {\n    get isFileSaverSupported() {\n      return isFileSaverSupported;\n    }\n    genType(fileName) {\n      if (!fileName || fileName.lastIndexOf('.') === -1) {\n        return 'text/plain';\n      }\n      const type = fileName.substring(fileName.lastIndexOf('.') + 1);\n      switch (type) {\n        case 'txt':\n          return 'text/plain';\n        case 'xml':\n        case 'html':\n          return `text/${type}`;\n        case 'json':\n          return 'octet/stream';\n        default:\n          return `application/${type}`;\n      }\n    }\n    save(blob, fileName, filtType, option) {\n      if (!blob) {\n        throw new Error('Data argument should be a blob instance');\n      }\n      const file = new Blob([blob], {\n        type: filtType || blob.type || this.genType(fileName)\n      });\n      saveAs(file, decodeURI(fileName || 'download'), option);\n    }\n    saveText(txt, fileName, option) {\n      const blob = new Blob([txt]);\n      this.save(blob, fileName, undefined, option);\n    }\n    static #_ = this.ɵfac = function FileSaverService_Factory(t) {\n      return new (t || FileSaverService)();\n    };\n    static #_2 = this.ɵprov = /* @__PURE__ */i0.ɵɵdefineInjectable({\n      token: FileSaverService,\n      factory: FileSaverService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return FileSaverService;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/* eslint-disable @angular-eslint/no-output-native */\nlet FileSaverDirective = /*#__PURE__*/(() => {\n  class FileSaverDirective {\n    constructor(ngZone, el, fss, httpClient) {\n      this.ngZone = ngZone;\n      this.el = el;\n      this.fss = fss;\n      this.httpClient = httpClient;\n      this.method = 'GET';\n      this.success = new EventEmitter();\n      this.error = new EventEmitter();\n      this.destroy$ = new Subject();\n      if (!fss.isFileSaverSupported) {\n        el.nativeElement.classList.add(`filesaver__not-support`);\n      }\n    }\n    ngOnInit() {\n      this.ngZone.runOutsideAngular(() => this.setupClickListener());\n    }\n    ngOnDestroy() {\n      this.destroy$.next();\n    }\n    getName(res) {\n      return decodeURI(this.fileName || res.headers.get('filename') || res.headers.get('x-filename') || '');\n    }\n    setDisabled(status) {\n      const el = this.el.nativeElement;\n      el.disabled = status;\n      el.classList[status ? 'add' : 'remove'](`filesaver__disabled`);\n    }\n    setupClickListener() {\n      fromEvent(this.el.nativeElement, 'click').pipe(filter(() => this.fss.isFileSaverSupported), takeUntil(this.destroy$)).subscribe(() => {\n        let req = this.http;\n        if (!req) {\n          let params = new HttpParams();\n          const query = this.query || {};\n          for (const item in query) {\n            params = params.set(item, query[item]);\n          }\n          req = this.httpClient.request(this.method, this.url, {\n            observe: 'response',\n            responseType: 'blob',\n            headers: this.header,\n            params\n          });\n        }\n        this.setDisabled(true);\n        req.pipe(takeUntil(this.destroy$)).subscribe({\n          next: response => {\n            if (response.status !== 200 || response.body.size <= 0) {\n              this.emitIfHasObservers(this.error, response);\n              return;\n            }\n            this.fss.save(response.body, this.getName(response), undefined, this.fsOptions);\n            this.emitIfHasObservers(this.success, response);\n          },\n          error: error => this.emitIfHasObservers(this.error, error),\n          complete: () => this.setDisabled(false)\n        });\n      });\n    }\n    emitIfHasObservers(emitter, value) {\n      if (hasObservers(emitter)) {\n        // Re-enter the Angular zone only if there're any `error` or `success` listeners\n        // on the directive, for instance, `(success)=\"...\"`.\n        this.ngZone.run(() => emitter.emit(value));\n      }\n    }\n    static #_ = this.ɵfac = function FileSaverDirective_Factory(t) {\n      return new (t || FileSaverDirective)(i0.ɵɵdirectiveInject(i0.NgZone), i0.ɵɵdirectiveInject(i0.ElementRef), i0.ɵɵdirectiveInject(FileSaverService), i0.ɵɵdirectiveInject(i2.HttpClient));\n    };\n    static #_2 = this.ɵdir = /* @__PURE__ */i0.ɵɵdefineDirective({\n      type: FileSaverDirective,\n      selectors: [[\"\", \"fileSaver\", \"\"]],\n      inputs: {\n        method: \"method\",\n        http: \"http\",\n        query: \"query\",\n        header: \"header\",\n        url: \"url\",\n        fileName: \"fileName\",\n        fsOptions: \"fsOptions\"\n      },\n      outputs: {\n        success: \"success\",\n        error: \"error\"\n      },\n      exportAs: [\"fileSaver\"],\n      standalone: true\n    });\n  }\n  return FileSaverDirective;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\nfunction hasObservers(subject) {\n  // Note: The `observed` property is available only in RxJS@7.2.0, which means it's\n  // not available for users running the lower version.\n  return subject.observed ?? subject.observers.length > 0;\n}\nlet FileSaverModule = /*#__PURE__*/(() => {\n  class FileSaverModule {\n    static #_ = this.ɵfac = function FileSaverModule_Factory(t) {\n      return new (t || FileSaverModule)();\n    };\n    static #_2 = this.ɵmod = /* @__PURE__ */i0.ɵɵdefineNgModule({\n      type: FileSaverModule\n    });\n    static #_3 = this.ɵinj = /* @__PURE__ */i0.ɵɵdefineInjector({});\n  }\n  return FileSaverModule;\n})();\n(function () {\n  (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n})();\n\n/**\n * Generated bundle index. Do not edit.\n */\n\nexport { FileSaverDirective, FileSaverModule, FileSaverService };\n//# sourceMappingURL=ngx-filesaver.mjs.map","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}